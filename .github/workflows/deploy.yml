deploy-to-ec2:
  needs: build-and-push
  runs-on: ubuntu-latest

  steps:
  - name: Deploy latest image to Windows EC2
    uses: appleboy/ssh-action@v1.0.3
    with:
      host: ${{ secrets.EC2_HOST }}
      username: ${{ secrets.EC2_USER }}
      key: ${{ secrets.EC2_KEY }}
      port: 22
      script: |
        powershell -Command "
          Write-Host '✅ Connected to EC2. Starting deployment...';
          Add-Content -Path C:\deploy_log.txt -Value ('Deployment triggered from GitHub at ' + (Get-Date));
          
          Write-Host 'Stopping existing container...';
          docker stop welcome_page;

          Write-Host 'Removing existing container...';
          docker rm welcome_page;

          Write-Host 'Pulling latest image...';
          docker pull ramuvchityala/welcome_page:latest;

          Write-Host 'Running new container...';
          docker run -d -p 80:80 --name welcome_page ramuvchityala/welcome_page:latest;

          Write-Host '✅ Deployment complete.';
        "